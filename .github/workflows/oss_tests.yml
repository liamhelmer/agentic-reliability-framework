# .github/workflows/oss_tests.yml
name: OSS Boundary Tests

on:
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'agentic_reliability_framework/arf_core/**'
      - 'scripts/**'
      - '.github/workflows/oss_tests.yml'

jobs:
  oss-boundary:
    name: OSS Boundary Validation
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Run OSS boundary check
      run: |
        python scripts/oss_boundary_check.py
        
    - name: Quick manual checks
      run: |
        echo "üîç Running quick OSS compliance checks..."
        
        # Check arf_core exists
        if [ ! -d "agentic_reliability_framework/arf_core" ]; then
          echo "‚ùå arf_core directory not found"
          exit 1
        fi
        
        # Check for forbidden patterns
        echo "Checking for Enterprise patterns in OSS code..."
        
        # Patterns that should NOT exist in OSS code
        FORBIDDEN_PATTERNS=(
          "EnterpriseMCPServer"
          "LicenseManager"
          "license_key"
          "validate_license"
          "MCPMode.APPROVAL"
          "MCPMode.AUTONOMOUS"
        )
        
        for pattern in "${FORBIDDEN_PATTERNS[@]}"; do
          echo "  Checking for: $pattern"
          if grep -r "$pattern" agentic_reliability_framework/arf_core/ --include="*.py"; then
            echo "‚ùå Found forbidden pattern '$pattern' in OSS code"
            exit 1
          fi
        done
        
        echo "‚úÖ All quick checks passed"
